# Iceraven Note

## Build Guide

### 1. Fork Repository

### 2. Add Repository Secrets

- **Note: Only for personal use, this key is different from upstream!**
- `DEBUG_SIGNING_KEY`

```bash
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
```

- `DEBUG_ALIAS`

```bash
key0
```

- `DEBUG_KEY_PASSWORD`

```bash
123456
```

- `DEBUG_KEY_STORE_PASSWORD`

```bash
123456
```

### 3. Edit Files

- `.github/workflows/android-build.yml`
- Could delete all other actions in `.github/workflows`

```yaml
name: Android build
on:
  workflow_dispatch:
  push:
    branches:
      - fork
jobs:
  run-build:
    runs-on: ubuntu-latest
    if: "! contains(toJSON(github.event.commits.*.message), '[skip ci]')"
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - name: Setup Java
        uses: actions/setup-java@v1
        with:
          java-version: 11
      - name: Install Android SDK with pieces Gradle skips
        run: ./automation/iceraven/install-sdk.sh
      - name: Create version name
        run: echo "VERSION_NAME=$(cat version.txt)" >> $GITHUB_ENV
      - name: Build forkRelease variant of app
        uses: eskatos/gradle-command-action@v1
        with:
          distributions-cache-enabled: true
          dependencies-cache-enabled: true
          configuration-cache-enabled: true
          arguments: assembleForkRelease -PversionName=${{ env.VERSION_NAME }}
      - name: Create signed APKs
        uses: abhijitvalluri/sign-apks@v0.8
        with:
          releaseDirectory: app/build/outputs/apk/forkRelease/
          signingKeyBase64: ${{ secrets.DEBUG_SIGNING_KEY }}
          alias: ${{ secrets.DEBUG_ALIAS }}
          keyStorePassword: ${{ secrets.DEBUG_KEY_STORE_PASSWORD }}
          keyPassword: ${{ secrets.DEBUG_KEY_PASSWORD }}
      - name: Archive arm64 apk
        uses: actions/upload-artifact@v2
        with:
          name: app-arm64-v8a-forkRelease.apk
          path: app/build/outputs/apk/forkRelease/app-arm64-v8a-forkRelease.apk
```

- `app/build.gradle`
- Change Default AMO Collections and speedup build

```bash
16201230 -> 16366570
What-I-want-on-Fenix -> addons-mobile
include "x86", "armeabi-v7a", "arm64-v8a", "x86_64" -> include "arm64-v8a"
```

- `app/src/main/java/org/mozilla/fenix/FeatureFlags.kt`
- Disable features

```kotlin
const val pullToRefreshEnabled = false
const val addressesFeature = false
const val showHomeButtonFeature = false
const val showStartOnHomeSettings = false
const val showRecentTabsFeature = false
const val recentBookmarksFeature = false
const val inactiveTabs = false
const val showHomeBehindSearch = false
const val customizeHome = false
const val tabGroupFeature = false
return listOf("en-US", "en-CA").contains(langTag) -> return listOf("nothing").contains(langTag)
```

- `app/src/main/java/org/mozilla/fenix/gecko/GeckoProvider.kt`
- Disable safebrowsing, Replace whole `if` block under comments

```kotlin
// Add safebrowsing providers for China
val o = SafeBrowsingProvider
    .from(ContentBlocking.GOOGLE_SAFE_BROWSING_PROVIDER)
    .getHashUrl("")
    .updateUrl("")
    .build()
runtimeSettings.contentBlocking.setSafeBrowsingProviders(o)
runtimeSettings.contentBlocking.setSafeBrowsingPhishingTable("goog-phish-proto")
```

- `app/src/main/res/values-zh-rTW/strings.xml`
- Add translations

```xml
<!-- Title for strip url preference in customization settings -->
<string name="preferences_strip_url_title">顯示縮短過的網址</string>
<!-- Description for strip url preference in customization settings -->
<string name="preferences_strip_url_description">隱藏網址中的 WWW/HTTP/HTTPS</string>
<!-- Preference for add-ons custom source -->
<string name="preferences_addons_customization">自訂附加元件來源</string>
<!-- Label for add-ons custom source account preference -->
<string name="addons_custom_source_account">附加元件集帳號</string>
<!-- Label for add-ons custom source collection preference -->
<string name="addons_custom_source_collection">附加元件集名稱</string>
<!-- Preference category for system behavior customization -->
<string name="preferences_system_behavior">系統行為</string>
<!-- Title for relinquish memory preference in customization settings -->
<string name="preferences_relinquish_memory_title">保留分頁</string>
<!-- Description for relinquish memory preference in customization settings -->
<string name="preferences_relinquish_memory_description">保留分頁，避免被系統自動關閉</string>
```

### 4. Push to `fork` branch to trigger build
